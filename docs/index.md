# ２０１９年度　ゼミ論文
![logo](https://github.com/kouki-T/imagebox/blob/master/unnamed%20(2).png?raw=true)
![logo2](https://github.com/kouki-T/imagebox/blob/master/bitmap.png?raw=true)
# OpenStreetMapにおけるローカル地域の更新頻度向上とその解決策の提案
-Improvement of update frequency of local area in OpenStreetMap and proposal of the solution-
# 
２０２０年２月１日


青山学院大学 地球社会共生学部 地球社会共生学科

武末 康輝/Kouki Takesue

学生番号　1A116138

指導教員　古橋 大地 教授

# 概要
本研究は、OpenStreetMap(以下OSM)プラットフォームを題材に、日本全地域の地図更新頻度を調査・分析し、特定地域とそれ以外の地域において更新頻度に著しい差が生じている現状を確認した。この問題はOSMのユーザーによる編集によって成り立っている仕様上国内外問わず発生しており、非常に重要なインシデントと考えられる。調査の範囲上今回は対象を国内へ絞り、更新頻度の収集と可視化を行うサービスをここに提案する。
　地図は現代生活において欠かせないツールであり、それは公的・私的利用問わず様々な範囲で活躍している。運輸サービスはルートデータがなければ物流をこなすことはできないし、地図アプリが無ければ見知らぬ土地で目的地へ辿り着くことは難しい。災害大国である日本では重要なインシデントが発生した場合、迅速な被災現場のルート管理、つまり地図の用意が必要になる。
　しかしながらOSMは現状、主要な都市とそれ以外のローカルな土地において更新頻度に大きな差が生じている。例えば渋谷などでは最終更新が三日前である場所もあるが、反対に横須賀などでは最終更新が三年前という場所も多く存在する。このような問題は今後OSMを利用したサービスが拡大するにあたって深刻なインシデントとなることは容易に想像できる。
　私はこの問題に対し、どのようなアプローチができるかを検討した結果、OSMの更新点であるchengesetを利用し更新頻度を可視化するようなサービスを作成し、それを普及させれば、ローカルな土地の更新を促せるのではないかと考え、そのサービスの作成と具体的な効果を提示する。

# Introduction
地図とは常に最新の状態を保つことが求められる。しかしながらその状態を維持するには多額のコストが必要となり、需要と供給の面から考えても現実的とは到底言い難い。OSMも例外では無く、オンライン地図サービスとして正確な情報をユーザーから要求されてはいるが、ユーザー編集によって成り立っているというシステム上完全な維持は難しいと言える。
  利用の多い都市部はデータも集まりやすく、修正点に気付く人も多いため更新頻度は常に高い。逆に利用者の少ないローカルな地域では最終更新が3年前というのも不思議ではない。しかしOSM側もなんら対応をしていないわけではなく、例えば公式にマッピングイベントを開催したり、HOT TaskingManagerとの連携を行い緊急度の高いエリアの更新を促したりと様々な対策を実施している。だが、それだけではローカル地域全ての更新頻度を向上させることはできない。
　そこで私はOSMの更新頻度を集計し、それを可視化することができれば多くのマッパーにローカル地域の更新を促し、気付かせることができるのではないかと考えた。それが今回提案するOSM UPDATE CHECKERである。

# Methods
今回の提案に際してまず二つのAPIエンジンをPython3.6を用いて作成した。これは今回OSMの更新頻度はWEB等で地図として表示することが望ましいと考え、必要となるDBの作成を別プロセスで半自動的に作動させる必要があると要件定義したからである。
　一つ目は、OSMからデータを収集しているPlanet.OSMからchangesetをbz形式で取得し、解凍。ElementTreeライブラリーを使用し中の緯度経度とタイムスタンプを抽出。その後そのデータをPostgresqlで一旦DBに保存する、「検索エンジン」だ。これによりOSMの更新履歴を作成することができる。
　二つ目は、DBから同じくPostgresqlによって緯度経度データを読み込み、Foliumライブラリに渡すことでヒートマップ表示する「表示エンジン」である。DBから緯度経度を検索する際にWHERE句指定することで期間指定を行うことができる。これにより将来的なデータ過多によって発生する表現限界問題を回避できると考えられる。
　以上のスクリプトをFlaskのテンプレートに組み込み、Herokuへとデプロイを行いWEBページとして公開を行った。

# Results
試験的に2019年9月1日から1万件のchangesetを検索し、日本の範囲のみをヒートマップとして表現する試みを行った。これは2019年9月9日に千葉県を中心に甚大な被害を起こした台風15号の影響によるOSMの更新頻度が集中することを証明するためであり、同時にHOT TaskingManagerによるOSM連携の効果を示すことができる。
   調査対象としては台風15号が発生し、HOT Tasking Managerが建てられる前の9月1日から9月10日のchangeset 3865件とTaskが建てられた後の9月10日から9月20日のchangeset 11065件をそれぞれOSMUCでヒートマップ表示した。
  結果としては図1(台風以前)図２（台風以後）のようになった。全体的にやはり関東地区、特に千葉県の部分に更新が集中しており、HOTの効果を充分に証明した反面、横須賀地区など被害のなかったローカルな地域は更新が行われておらず、OSMの更新頻度自体が上昇しても、その他地域への影響は全く無いことが示されている。
  これによりOSMの更新頻度は災害などの注目によって集中することがわかり、更に逆説的にその他のローカルな地域は更新頻度が低く、地図としての更新義務を果たせてるとは言えないということが示された。このような問題点をビジュアライズ化することができる当サービスの有用性が確認できたと考えられる。

（図1）
![img1](https://github.com/kouki-T/imagebox/blob/master/unnamed.png?raw=true)
（図2）
![img2](https://github.com/kouki-T/imagebox/blob/master/unnamed%20(1).png?raw=true)

# Discussion
ローカルな土地の更新頻度を向上させるためにまず、なぜローカルな土地の更新が滞そるのかを議論した。利用需要の低さや最新衛星写真の整備がされていない等様々な原因が考えられたが、その中でも特に重要視されたのが、そもそも更新されていないことに編集者であるユーザーが気づいていないという点であった。
 OSMには様々な連携サイトがあり、様々な形でユーザーがOSMを利用したサービスに関わっている。MapboxとFacebookの連携やPokemon Go、Uber等近年多様なサービスの台頭により地図利用頻度は更に増している。このようにユーザー数が増え、利用頻度が向上するにつれ、まさか更新の停滞している地域があるはずないという考えに捕らわれてしまうのである。
  またchangesetという差分データに着目することで軽量かつ短時間で大量の緯度経度情報を収集することが可能となった。処理においてもplanet.osmからのbz形式でのダウンロード、展開、ETによるパースからpostgresqlへの保存に10秒とかからない点は今後同様の解析を行う際には有用だと評価された。

# Conclusion
この研究を通して、現状OSMの地図更新には中心都市とそれ以外のローカルの土地において大きな差が生じていることがOSMUCによって明らかとなった。HOTなどによる外部連携による地図更新は非常に有意ではあるが、災害時という限定的な範囲のためそれ以外の土地には効果を示さない。議論によってマッパーへのローカルな土地の低更新な現状を｢気づかせる｣という課題について、本サービスは効果的であると考えられる。
  今後の課題については、本サービスはまだまだ実装したてでありいくつかの足りないサービスが存在する。特にマッパーへローカルな土地の更新頻度に気づかせた後即座にその場所の更新に移れるようなOSMとの連携については未実装である。さらに現状のデータ収集法では大量のアクセスを必要としplanet.osmへ大きな負荷を掛けてしまう点も無視出来ない。より効率よくかつ他のサービスとの連携をどのように折り合いつけていくか、この点が今後の課題であると感じた。

# addition
本研究では当初changesetデータを収集するにあたってOSMの公式APIからchangesetデータをxml形式で取得していたが、約8000件の取得を行った時点で公式APIから通信を遮断されてしまった。そのため別案としてPlanetOSMを利用したが、今後同じような対処がなされる可能性も高い。オープンデータとして公開されているデータではあるが未だ大量データの受け渡しの方法としては問題が残るのではないかという疑問点と限界点についてここに補足という形で最後に付け加える。

# Reference
[古橋ゼミ卒論2019-2020参考文献・参考資料リスト-Kouki Takesue](https://docs.google.com/spreadsheets/d/15s6fjbjaUqAXOm3RTmikgRs0yxqCvqb6uQqei54mvPI/edit?usp=sharing)

# Acknowledgements
本研究を進めるにあたり古橋研究室の古橋氏をはじめ多くの方々より多大な助言を賜りました。厚く感謝を申し上げます。
